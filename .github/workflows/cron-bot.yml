name: Auto Trigger News Bot

on:
  # 1. Cấu hình chạy tự động (theo giờ UTC)
  schedule:
    # Chạy mỗi 4 tiếng một lần (vào phút thứ 0)
    # Các mốc giờ chạy (giờ VN): 7h sáng, 11h trưa, 3h chiều, 7h tối, 11h đêm...
    - cron: '0 */4 * * *'

  # 2. Cho phép bấm nút "Run workflow" thủ công để test ngay
  workflow_dispatch:

jobs:
  wake_up_and_post:
    name: Call API Bot
    runs-on: ubuntu-latest
    steps:
      - name: Call API Endpoint
        run: |
          # Gọi API với Key bảo mật
          response=$(curl -s -w "%{http_code}" -X POST "https://api-gavl-ewhshvbfhwdccras.southeastasia-01.azurewebsites.net/api/post/bot?key=${{ secrets.BOT_SECRET_KEY }}")
          
          # Lấy HTTP Status Code (ví dụ 200, 401, 500)
          http_code=${response: -3}
          
          # In ra kết quả để debug
          echo "API responded with status: $http_code"
          
          if [ "$http_code" -ne 200 ]; then
            echo "❌ Error: API call failed!"
            exit 1
          else
            echo "✅ Success: Bot ran successfully!"
          fi
